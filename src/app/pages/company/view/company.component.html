<app-headernavigation></app-headernavigation>
@if (isLoadingResults) {
  <mat-spinner></mat-spinner>
} @else {
  <form [formGroup]="form" class="row">
    <ng-select
      [items]="institutions"
      appendTo="body"
      bindLabel="keyName"
      formControlName="institution"
    ></ng-select>

    <ng-select
      [items]="academicPrograms"
      appendTo="body"
      bindLabel="keyName"
      formControlName="academicProgram"
    ></ng-select>

    <button mat-flat-button class="primary-button">{{ 'companyPage.button.add' | translate }}</button>
    <input type="file" #fileInput (change)="onFileSelect($event)" accept=".csv, .xslx" style="display: none;">
    <button mat-flat-button class="primary-button" (click)="fileInput.click()">
      <mat-icon>file_upload</mat-icon>
      {{ 'companyPage.button.import' | translate }}
    </button>


  </form>
  @if (userLoading) {
    <mat-spinner></mat-spinner>
  } @else {
    <table [dataSource]="dataSource" class="mat-elevation-z8" mat-table matSort>
      <ng-container matColumnDef="name">
        <th *matHeaderCellDef mat-header-cell mat-sort-header>{{ 'companyPage.table.name' | translate }}</th>
        <td *matCellDef="let user" mat-cell>{{ user.company.name }}</td>
      </ng-container>

      <ng-container matColumnDef="email">
        <th *matHeaderCellDef mat-header-cell mat-sort-header>{{ 'companyPage.table.email' | translate }}</th>
        <td *matCellDef="let user" mat-cell>{{ user.email }}</td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th *matHeaderCellDef mat-header-cell mat-sort-header>{{ 'companyPage.table.status' | translate }}</th>
        <td *matCellDef="let user" mat-cell>
          <div [ngClass]="{'isNotActive': !user.company.isActive, 'isActive': user.company.isActive}">
            {{ (user.company.isActive ? 'companyPage.table.statusOpen' : 'companyPage.table.statusTaken') | translate }}
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="industry">
        <th *matHeaderCellDef mat-header-cell mat-sort-header>{{ 'companyPage.table.industry' | translate }}</th>
        <td *matCellDef="let user" mat-cell>{{ user.company.industry }}</td>
      </ng-container>

      <ng-container matColumnDef="companyWebsite">
        <th *matHeaderCellDef mat-header-cell mat-sort-header>{{ 'companyPage.table.website' | translate }}</th>
        <td *matCellDef="let user" mat-cell><a href="{{ user.company.website }}">{{ user.company.website }}</a></td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th *matHeaderCellDef mat-header-cell mat-sort-header>{{ 'companyPage.table.actions' | translate }}</th>
        <td mat-cell *matCellDef="let user">
          <button mat-icon-button [matMenuTriggerFor]="menu" (click)="$event.stopPropagation()">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="updateStatus(user, $event)">
              <span>{{ 'companyPage.button.status' | translate }} {{ (user.company.isActive ? 'companyPage.table.statusTaken' : 'companyPage.table.statusOpen') | translate }} </span>
            </button>
          </mat-menu>
        </td>

      </ng-container>
      <tr *matHeaderRowDef="displayedColumns" mat-header-row></tr>
      <tr *matRowDef="let row; columns: displayedColumns;" mat-row (dblclick)="openCompanyDialog(row.company.id)"></tr>
    </table>
  }
}
